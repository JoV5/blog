## `this`到底是什么
`this`是在运行时进行绑定的，并不是在编写时绑定，它的上下文取决于函数调用时的各种条件。`this`的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式。

当一个函数被调用时，会创建一个活动记录（有时候也称为执行上下文）。这个记录会包含函数在哪里被调用（调用栈）、函数的调用方法、传入的参数等信息。`this`就是记录的其中一个属性，会在函数执行的过程中用到。

## 绑定规则
1. 默认绑定

    最常用的函数调用类型：独立函数调用。可以把这条规则看作是无法应用其他规则时的默认规则。

    this将指向全局对象。在严格模式下，全局对象将无法使用默认绑定，因此this会绑定到`undefined`。

2. 隐式绑定

    当函数引用有上下文对象时，或者说是否被某个对象拥有或者包含，隐式绑定规则会把函数调用中的this绑定到这个上下文对象。

    ##### 隐式丢失

    一个常见的`this`绑定问题就是被隐式绑定的函数会丢失绑定对象，也就是说它会应用默认绑定，从而把`this`绑定到全局对象或者`undefined`上，取决于是否是严格模式。

    回调函数丢失`this`绑定是非常常见的。除此之外，还有一种情况`this`的行为会出乎意料：调用回调函数的函数可能会修改`this`。在一些流行的JavaScript库中事件处理器常会把回调函数的`this`强制绑定到出发时间的DOM元素上。

3. 显示绑定

    使用函数的`call()`和`apply()`方法。这两个方法的第一个参数是一个对象，它们会把这个对象绑定到`this`，接着在调用函数时指定这个`this`。

    在ES5中提供了内置的方法`Function.prototype.bind`，返回一个硬编码的新函数，它会把参数设置为`this`的上下文并调用原始函数。

4. new绑定

    JavaScript中`new`的机制实际上和面向类的语言完全不同。JavaScript中，构造函数只是一些使用`new`操作符时被调用的函数。它们并不会属于某个类，也不会实例化一个类。实际上，它们都不能说是一种特殊的函数类型，只是被`new`操作符调用的普通函数而已。

    包括内置对象函数（比如Number()等）在内的所有函数都可以用new来调用，这种函数调用被称为构造函数调用。这里有一个重要但是非常细微的区别：实际上并不存在所谓的“构造函数”，只有对于函数的“构造调用”。
   
    使用new来调用函数，或者说发生构造函数调用时，会自动执行下面的操作。
    1. 创建（或者说构造）一个全新的对象
    2. 这个新对象会执行[[原型]]连接。
    3. 这个新对象会绑定到函数调用的this。
    4. 如果函数没有返回其他对象，那么`new`表达式中的函数调用会自动返回这个新对象。

### 判断`this`
1. 由`new`调用？绑定到新创建的对象。
2. 由`call`或`apply`（或者`bind`）调用？绑定到指定的对象。
3. 由上下文对象调用？绑定到那个上下文对象。
4. 默认：在严格模式下绑定到`undefined`，否则绑定到全局对象。

### 箭头函数
箭头函数并不使用`function`关键字定义的，而是使用被称为“胖箭头”的操作符=>定义的。箭头函数不使用`this`的四种标准规则，而是根据外层（函数或者全局）作用域来决定`this`。

箭头函数最常用于回调函数中，例如事件处理器或者定时器。它可以向`bind(..)`一样确保函数的`this`被绑定到指定对象，此外，其重要性还体现在它用更常见的词法作用域取代了传统的`this`机制。这与ES6之前代码中的`self=this`机制一样。